<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Task Manager Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    td {
      word-break: break-word;
      max-width: 250px;
    }
    th, td {
      text-align: left;
      vertical-align: top;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">

<div class="flex h-screen overflow-hidden">
  <!-- Sidebar -->
  <aside class="w-64 bg-gray-200 p-4 space-y-4 flex-shrink-0 fixed h-full" id="sidebar-nav">
    <div class="flex items-center gap-2 text-xl font-bold mb-6">
      <div class="logo-icon">ðŸ”’</div>
      <span>LOCKATED</span>
    </div>
    <nav class="space-y-2">
      <a href="#" data-resource="posts" class="flex items-center gap-3 p-2 rounded-md bg-red-500 text-white">
        <i class="fas fa-file-alt"></i> Posts
      </a>
      <a href="#" data-resource="comments" class="flex items-center gap-3 p-2 rounded-md hover:bg-gray-300 text-gray-700">
        <i class="fas fa-flag"></i> Comments
      </a>
      <a href="#" data-resource="albums" class="flex items-center gap-3 p-2 rounded-md hover:bg-gray-300 text-gray-700">
        <i class="fas fa-chart-bar"></i> Albums
      </a>
      <a href="#" data-resource="photos" class="flex items-center gap-3 p-2 rounded-md hover:bg-gray-300 text-gray-700">
        <i class="fas fa-check-circle"></i> Photos
      </a>
      <a href="#" data-resource="todos" class="flex items-center gap-3 p-2 rounded-md hover:bg-gray-300 text-gray-700">
        <i class="fas fa-comments"></i> Todos
      </a>
      <a href="#" data-resource="users" class="flex items-center gap-3 p-2 rounded-md hover:bg-gray-300 text-gray-700">
        <i class="fas fa-bullseye"></i> Users
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="ml-64 flex-1 p-6 overflow-auto">
    <!-- Tabs -->
    <div class="flex gap-6 border-b-2 mb-4">
      <button class="border-b-4 border-red-500 text-red-600 font-semibold pb-2">Active Projects</button>
      <button class="pb-2 hover:text-red-600">Templates</button>
    </div>

    <!-- Add Task -->
    <div id="add-task-section" class="space-y-2 mb-6">
      <div id="input-fields" class="grid sm:grid-cols-2 md:grid-cols-3 gap-2"></div>
      <button onclick="addNewTask()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
        Add Task
      </button>
    </div>

    <!-- Scrollable Table Container -->
    <div id="table-container" class="bg-white rounded-lg shadow p-4 max-h-[500px] overflow-auto">
      <p class="text-gray-500">Loading posts...</p>
    </div>
  </main>
</div>

<script>
  const sidebarNav = document.getElementById('sidebar-nav');
  const tableContainer = document.getElementById('table-container');
  const inputFieldsDiv = document.getElementById('input-fields');
  let currentResource = "posts";
  const savedData = {};

  const fieldTemplates = {
    posts: ['userId', 'id', 'title', 'body'],
    comments: ['postId', 'id', 'name', 'email', 'body'],
    albums: ['userId', 'id', 'title'],
    photos: ['albumId', 'id', 'title', 'url', 'thumbnailUrl'],
    todos: ['userId', 'id', 'title', 'completed'],
    users: ['id', 'name', 'username', 'email']
  };

  function formatValue(value) {
    return typeof value === 'object' && value !== null
      ? (value.name || value.title || value.email || JSON.stringify(value))
      : String(value);
  }

  function buildTable(resource, data) {
    if (!data || !data.length) return '<p class="p-4 text-gray-500">No data to display.</p>';
    const headers = Object.keys(data[0]);
    const thead = `
      <thead class="bg-gray-100 text-gray-700">
        <tr>${headers.map(h => `<th class="p-3">${h}</th>`).join('')}<th class="p-3">Actions</th></tr>
      </thead>`;
    const tbody = data.map((item, rowIndex) => `
      <tr class="border-t" data-row="${rowIndex}">
        ${headers.map(key => `
          <td contenteditable="true" class="p-3 border border-transparent hover:border-gray-300 cursor-text whitespace-pre-wrap break-words max-w-[250px]"
              data-key="${key}" data-row="${rowIndex}">${formatValue(item[key])}</td>`).join('')}
        <td class="p-3">
          <button onclick="deleteRow('${resource}', ${rowIndex})"
                  class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
        </td>
      </tr>`).join('');
    return `<div class="overflow-x-auto"><table class="min-w-full text-sm text-left" id="data-table">${thead}<tbody>${tbody}</tbody></table></div>`;
  }

  async function loadData(resource) {
    tableContainer.innerHTML = `<p class="p-4 text-gray-500">Loading ${resource}...</p>`;
    try {
      if (savedData[resource]) {
        tableContainer.innerHTML = buildTable(resource, savedData[resource]);
        attachCellListeners(resource);
        renderInputFields(resource);
        return;
      }
      const res = await fetch(`https://jsonplaceholder.typicode.com/${resource}`);
      const data = await res.json();
      const limitedData = Array.isArray(data) ? data.slice(0, 20) : [data];
      savedData[resource] = limitedData;
      tableContainer.innerHTML = buildTable(resource, limitedData);
      attachCellListeners(resource);
      renderInputFields(resource);
    } catch (error) {
      tableContainer.innerHTML = `<p class="p-4 text-red-500">Error loading data: ${error.message}</p>`;
    }
  }

  function renderInputFields(resource) {
    inputFieldsDiv.innerHTML = "";
    const fields = fieldTemplates[resource] || [];
    fields.forEach(field => {
      const isBool = field === 'completed';
      inputFieldsDiv.innerHTML += `
        <input type="${isBool ? 'checkbox' : 'text'}" name="${field}" id="field-${field}"
          class="p-2 border rounded" placeholder="${field}" ${isBool ? '' : 'value=""'} />
      `;
    });
  }

  function getFieldValues(resource) {
    const fields = fieldTemplates[resource];
    const newItem = {};
    fields.forEach(field => {
      const input = document.getElementById(`field-${field}`);
      if (!input) return;
      if (input.type === "checkbox") {
        newItem[field] = input.checked;
      } else if (field === "id") {
        newItem[field] = Date.now();
      } else if (["userId", "postId", "albumId"].includes(field)) {
        newItem[field] = parseInt(input.value) || 1;
      } else {
        newItem[field] = input.value.trim();
      }
    });
    return newItem;
  }

  function attachCellListeners(resource) {
    const cells = document.querySelectorAll('td[contenteditable="true"]');
    cells.forEach(cell => {
      cell.addEventListener('focus', () => {
        cell.classList.add('outline-none', 'ring-2', 'ring-red-400', 'bg-red-50');
      });
      cell.addEventListener('blur', () => {
        const rowIndex = cell.dataset.row;
        const key = cell.dataset.key;
        const newValue = cell.innerText.trim();
        savedData[resource][rowIndex][key] = newValue;
        cell.classList.remove('ring-2', 'ring-red-400', 'bg-red-50');
      });
      cell.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          cell.blur();
        }
      });
    });
  }

  function deleteRow(resource, rowIndex) {
    if (!confirm("Are you sure you want to delete this task?")) return;
    savedData[resource].splice(rowIndex, 1);
    tableContainer.innerHTML = buildTable(resource, savedData[resource]);
    attachCellListeners(resource);
  }

  function addNewTask() {
    const newItem = getFieldValues(currentResource);
    const requiredFields = fieldTemplates[currentResource].filter(f => f !== 'id');
    const isEmpty = requiredFields.some(f => {
      const value = newItem[f];
      return value === undefined || value === null || value === '';
    });
    if (isEmpty) {
      return alert("Please fill in all fields before adding.");
    }
    savedData[currentResource] = savedData[currentResource] || [];
    savedData[currentResource].unshift(newItem);
    tableContainer.innerHTML = buildTable(currentResource, savedData[currentResource]);
    attachCellListeners(currentResource);
    document.querySelectorAll('#input-fields input').forEach(input => {
      if (input.type === 'checkbox') input.checked = false;
      else input.value = '';
    });
  }

  sidebarNav.querySelectorAll('a[data-resource]').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      currentResource = link.dataset.resource;
      sidebarNav.querySelectorAll('a[data-resource]').forEach(a => {
        a.classList.remove('bg-red-500', 'text-white');
        a.classList.add('hover:bg-gray-300', 'text-gray-700');
      });
      link.classList.add('bg-red-500', 'text-white');
      link.classList.remove('hover:bg-gray-300', 'text-gray-700');
      loadData(currentResource);
    });
  });

  // Initial load
  window.onload = () => loadData(currentResource);
</script>
</body>
</html>
